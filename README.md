# CS 262 Design Exercise 1: Wire Protocols

## Description

This is a chat application that we designed for CS262 using wire protocols.

## Setup

Installations you may need:

Ensure that protoc is installed with
```
protoc --version
```

## Built on

We built a server and client using the `socket` and `threading` native Python libraries for our wire protocol implementation. For our GRPC implementation, we used the `grpcio` and `grpcio-tools` libraries.

## Installation

Install the dependencies in `requirements_<OS>.txt` using conda by creating a new conda environment and running `conda install --file requirements_<OS>.txt` for your respective OS. If this fails, in a new conda envrionment run:

```
conda install grpcio grpcio-tools pyyaml
```

If this fails, run:
```
pip3 install grpcio grpcio-tools pyyaml
```

## How to run the app

Modify the `config.yaml` file to change the host name so that it matches in the server and client. To get the host name, run `ipconfig getifaddr en0` on Mac or `ipconfig getifaddr eth0` on Linux or run `ipconfig` and look for the IPv4 address on.

Navigate into the `chat` folder 

and run `python3 server.py` on the server first, and  navigate into the `chat` folder and run `python3 client.py` on the client. 

After the client has connected to the server, type in a command in the client terminal, following the commands below.

### Commands for the client

All messages sent by the client be an op code followed by the pipe "|" character.

```
Format: <command>|<text>
0|                  -> list user accounts
1|<username>        -> create an account with name username
2|<username>        -> login to an account with name username
3|<username>        -> logout from current account
4|                  -> delete current account
5|<username>|<text> -> send message to username
6|                  -> deliver all unsent messages to current user
```

### Disconnecting the client

To shut down the client and disconnect from the server, type `quit` in the client terminal. 

## How to run the tests

Navigate into the `chat` folder and run `python3 tests.py`. Tests should all pass with a `All tests passed!` message in the console. 

## Folder Structure
```
├── chat	                    # All of the code is here
|   ├── grpc_proto	            # GRPC implementation in here
|   |   ├── chat_pb2_grpc.py    # file autogenerated by GRPC
|   |   ├── chat_pb2.py         # file autogenerated by GRPC
|   |   ├── chat.proto          # Definition of Protocol Buffer Objects
|   |   ├── client.py           # Client specific code to GRPC
|   |   └── server.py           # Server specific code to GRPC
|   ├── wire	                # wire implementation in here
|   |   ├── chat_service.py     # Code for defining classes (User, Chat) used by the client and server
|   |   ├── client.py           # Client specific code to wire protocol
|   |   ├── server.py           # Server specific code to wire protocol
|   |   └── wire_protocol.py    # Code for defining the wire protocol
|   ├── __init__.py		        # Initializes application from config file
│   ├── client.py               # Contains the common code for client
│   ├── server.py               # Contains the common code for server
│   ├── wire_protocol.py        # Contains the code for defining the wire protocol
|   ├── tests.py	            # Unit tests for the wire protocol application
|   └── utils.py		        # Defines common functions used by the application
├── .gitignore	
├── NOTEBOOK.md                 # Engineering notebook	
└── README.md                   # README
```